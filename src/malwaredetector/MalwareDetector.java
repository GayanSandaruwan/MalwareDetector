/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package malwaredetector;

/**
 *
 * @author Gayan Sandaruwan
 */
import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import javax.swing.JFileChooser;
import javax.swing.JOptionPane;


public class MalwareDetector {

    //To store virus definition md5 hashes and their respective names and types
    public static ArrayList<String> virusDefinitions = new ArrayList<String>();
    public static ArrayList<String> virusNames = new ArrayList<String>();;
    public static ArrayList<String> virusTypes = new ArrayList<String>();;

    public static void main(String[] args) {
        
        try {
            System.out.println("Select the file to detect for virus ");
            
            //File chooser select the file to detect
            File file = fileChooser();
            System.out.println(file.toString());

            Logic logic = new Logic();
            
            //Generating md5 checksum value of the given file
            String fileChecksum = logic.generateMD(file.toString());
            
            //Reading the virus definitions and storing them in a array list
            FileHandle fileHandler = new FileHandle();
            boolean status = fileHandler.readVirusDefinition(); // Ststus is the output from the analyser

            if(status){
                
                int index = logic.analyze(fileChecksum, virusDefinitions);

                if(index==-1){
                    System.out.println("Clean File !!");
                    JOptionPane.showMessageDialog(null, file.getName()+" given file does not contain a virus.\nFile MD5: "+fileChecksum+"\nis not found in virus definitions", "No Virus !!",JOptionPane.INFORMATION_MESSAGE);
               }else{    
                    System.out.println("Virus Detected !!");
                    JOptionPane.showMessageDialog(null, 
                            file.getName()+" file contains a virus.\n"
                                    + "File MD5: "+fileChecksum+"\nis found in virus definitions\n"
                                    + "Virus Name: "+virusNames.get(index)+"\nVirus Type: "+virusTypes.get(index), 
                            "Virus Detected !!",JOptionPane.WARNING_MESSAGE);
                }
            }else{
                System.out.println("virusDef.txt can not be found.Without virus definition analysing can not be completed! Exitting.");
            }
         
        } catch (Exception ex) {
            System.out.println(ex.toString());
        }
    }
    
    //File chooser to select file
    public static File fileChooser(){
        JFileChooser chooser = new JFileChooser();
        chooser.setDialogTitle("Select the file to detect");

        if (chooser.showOpenDialog(null) == JFileChooser.APPROVE_OPTION) {
          return chooser.getSelectedFile();
        } else {
          return null;
        }    
    }
    
}

